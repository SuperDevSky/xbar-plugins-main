#!/usr/bin/env bash

#  <xbar.title>Mac Low Power Mode Manager</xbar.title>
#  <xbar.version>v1.0</xbar.version>
#  <xbar.author>Anderson</xbar.author>
#  <xbar.author.github>andersonaddo</xbar.author.github>
#  <xbar.desc>A good shortcut to check and toggle your Macbook's Low Power Mode. Check out https://github.com/andersonaddo/xbar-low-power-mode-tool for important installation instructions!</xbar.desc>
#  <xbar.image>https://raw.githubusercontent.com/andersonaddo/xbar-low-power-mode-tool/main/icon.png</xbar.image>
#  <xbar.abouturl>https://github.com/andersonaddo/xbar-low-power-mode-tool</xbar.abouturl>

#icons (144dpi, each about 34 x 34ppx)
ac_leaf_image="iVBORw0KGgoAAAANSUhEUgAAACQAAAAmCAYAAACsyDmTAAAAAXNSR0IArs4c6QAAAOZlWElmTU0AKgAAAAgABgESAAMAAAABAAEAAAEaAAUAAAABAAAAVgEbAAUAAAABAAAAXgExAAIAAAAhAAAAZgEyAAIAAAAUAAAAiIdpAAQAAAABAAAAnAAAAAAAAACQAAAAAQAAAJAAAAABQWRvYmUgUGhvdG9zaG9wIDIxLjIgKE1hY2ludG9zaCkAADIwMjM6MDE6MDYgMTc6Mzg6MzMAAASQBAACAAAAFAAAANKgAQADAAAAAQABAACgAgAEAAAAAQAAACSgAwAEAAAAAQAAACYAAAAAMjAyMzowMTowNiAxNzozNzo0MgCNXXmpAAAACXBIWXMAABYlAAAWJQFJUiTwAAAHvmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iCiAgICAgICAgICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICAgICAgICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAyMy0wMS0wNlQxNzozODozMyswNTozMDwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+QWRvYmUgUGhvdG9zaG9wIDIxLjIgKE1hY2ludG9zaCk8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMjMtMDEtMDZUMTc6Mzc6NDIrMDU6MzA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDIzLTAxLTA2VDE3OjM4OjMzKzA1OjMwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8eG1wTU06SGlzdG9yeT4KICAgICAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgMjEuMiAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAyMy0wMS0wNlQxNzozNzo0MiswNTozMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDo4ODhiNWJjMi1jNDc5LTQ1NDktOGM5Mi00YTQzYTYwMTg4NDY8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y3JlYXRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6U2VxPgogICAgICAgICA8L3htcE1NOkhpc3Rvcnk+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDo4ODhiNWJjMi1jNDc5LTQ1NDktOGM5Mi00YTQzYTYwMTg4NDY8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAg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"
ac_no_leaf_image="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"
battery_leaf_image="iVBORw0KGgoAAAANSUhEUgAAACQAAAAeCAYAAABE4bxTAAAAAXNSR0IArs4c6QAAAOZlWElmTU0AKgAAAAgABgESAAMAAAABAAEAAAEaAAUAAAABAAAAVgEbAAUAAAABAAAAXgExAAIAAAAhAAAAZgEyAAIAAAAUAAAAiIdpAAQAAAABAAAAnAAAAAAAAACQAAAAAQAAAJAAAAABQWRvYmUgUGhvdG9zaG9wIDIxLjIgKE1hY2ludG9zaCkAADIwMjM6MDE6MDYgMTc6Mzg6MzEAAASQBAACAAAAFAAAANKgAQADAAAAAQABAACgAgAEAAAAAQAAACSgAwAEAAAAAQAAAB4AAAAAMjAyMzowMTowNiAxNzozNjo0MACBzayjAAAACXBIWXMAABYlAAAWJQFJUiTwAAAHvmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgICAgICAgICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgICAgICAgICAgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iCiAgICAgICAgICAgIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiCiAgICAgICAgICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAyMy0wMS0wNlQxNzozODozMSswNTozMDwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+QWRvYmUgUGhvdG9zaG9wIDIxLjIgKE1hY2ludG9zaCk8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMjMtMDEtMDZUMTc6MzY6NDArMDU6MzA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDIzLTAxLTA2VDE3OjM4OjMxKzA1OjMwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8eG1wTU06SGlzdG9yeT4KICAgICAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgMjEuMiAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAyMy0wMS0wNlQxNzozNjo0MCswNTozMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDpjN2U1NjFiYi04ZWYwLTRjYmQtODlmOS1lMTc1MzdjNDg2ODA8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y3JlYXRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6U2VxPgogICAgICAgICA8L3htcE1NOkhpc3Rvcnk+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDpjN2U1NjFiYi04ZWYwLTRjYmQtODlmOS1lMTc1MzdjNDg2ODA8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAg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"
battery_no_leaf_image="iVBORw0KGgoAAAANSUhEUgAAACQAAAAbCAYAAAAULC3gAAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAACQAAAAAQAAAJAAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACSgAwAEAAAAAQAAABsAAAAAG0ctPgAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAAAsNJREFUSA3NlT9PFUEUxfmjKNJoIibaUVHRmEBBLOn8ED7xE2ijDY09oaMjEBND4mewUmtsLNDCPCsSjRorn+ADz2+Zs943DBuC7wknOTt35v7duzOzQ0N/cUHiRZERPBF/iL/ETuBPyc/FSyIYFUcSkQE6bKIfMrGISWxALrNa4DEsOpAXZyUcHMP9tP7YxoURHf62LcUiRwQ1DFOMsSDhnnhdnBKnxd8ib0BAgyQ4fxa3xDHReuLtirfFG2JXxNZ6idUaMd+LH8Vv4ob4UqyxLAmnSILFeZSb3tx2TTYlHTVUaOlJkD2Rb8zYVIwTYoNtiaWE9vNofzoKWW+JVduZENjG/R5J3lSkc2/xzTk1l1MxcU9pqS+gEE4h4EVLObzeQelulAwJ8i9wMV8U5Io4ITp5Hrdeb2qliz3N6H34SZn5AvOpGGIdm5NWljqDA0eeoCVaJ3UR+LMvwLbIpfhOpFMAHTZHwH2QgzfwzZvr8jlBvT+s85pv8mtJwSe7mmTuLmDbw5meeUE22JHukfg12VCkQUfp2pJ4J8lcfoB15DfiU5FPxQUKuADvivhT5Ip4U3ROiYeI+8PH74WVDeMD6fD1HRJldBF5F9GRI/pUdVAtgoHMGknWRTrFDze3obMtMX9Dvy1++GP3QVwTOWEPReLxW1kU/dshZw2SRRI0zpvkkm2+9jZlulWIm9se5HsIX3eNk9QE9krpU+BPIn5D46JP1vckTyYd3enpjOZHNjVrAENae1pQKBsazInz4oxIMXTcJ1BiL9yN3tX+zUied6G0VmccdEEk8h5EJl9eIOs1/kdBdbKTCKVNeRK/gdmcy4K47s8LunSonao5y8Kcu01Bm6kgfhcofCrimEyKA3YRce4Y1nseR3KSG1S1cOO+EqPRWcivVcMoxZD8mcgVwP+GnyBXP5UPmnSmLa6K98XuH9WpkfgE1LmdAAAAAElFTkSuQmCC"

#Power modes
NOT_SUPPORTED=0
LOW_POWER_MODE=2
NORMAL_MODE=3

is_in_low_power_mode=0
is_charging=0

get_power_info() {
  local mode_info_raw=$(pmset -g | grep lowpowermode)
  local charging_status_raw=$(pmset -g batt | grep "Now drawing")

  if [[ $mode_info_raw == *"0"* ]]; then
    is_in_low_power_mode=$NORMAL_MODE
  elif [[ $mode_info_raw == *"1"* ]]; then
    is_in_low_power_mode=$LOW_POWER_MODE
  else
    is_in_low_power_mode=$NOT_SUPPORTED
  fi

  if [[ $charging_status_raw == *"AC Power"* ]]; then
    is_charging=1
  fi
}

toggle_low_power_mode() {
  get_power_info

  local new_mode=0

  if [[ $is_in_low_power_mode == $NORMAL_MODE ]]; then
    new_mode=1
  elif [[ $is_in_low_power_mode == $LOW_POWER_MODE ]]; then
    new_mode=0
  fi

  if [[ $is_charging == 1 ]]; then
    sudo pmset -c lowpowermode $new_mode #changing only the ac power settings
  else
    sudo pmset -b lowpowermode $new_mode #changing only the battery power settings
  fi
}

main() {
  get_power_info

  if [[ $is_in_low_power_mode == $NOT_SUPPORTED ]]; then
    echo "-"
    exit 0
  fi

  if [[ $is_in_low_power_mode == $NORMAL_MODE ]]; then
    local image=$([[ $is_charging == 1 ]] && echo "$ac_no_leaf_image" || echo "$battery_no_leaf_image")
    echo "| templateImage=$image"
    echo "---"
    echo "Low Power Mode is off (for AC power)"
  elif [[ $is_in_low_power_mode == $LOW_POWER_MODE ]]; then
    local image=$([[ $is_charging == 1 ]] && echo "$ac_leaf_image" || echo "$battery_leaf_image")
    echo "LPM | templateImage=$image color=lightgreen"
    echo "---"
    echo "Low Power Mode is on $is_charging_text"
  fi

  if [[ $is_in_low_power_mode == $LOW_POWER_MODE ]] || [[ $is_in_low_power_mode == $NORMAL_MODE ]]; then
    if [[ $is_charging == 1 ]]; then
      echo "Toggle Low Power Mode (for AC power) | bash='$0' param1=toggle_mode terminal=false refresh=true"
    else
      echo "Toggle Low Power Mode (for battery) | bash='$0' param1=toggle_mode terminal=false refresh=true"
    fi
  fi

  echo "Refresh | refresh=true"
}

if [ "$1" == "toggle_mode" ]; then
  toggle_low_power_mode
else
  main
fi
